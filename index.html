<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>RahatEarn - Earn Rewards</title>

<link rel="icon" href="/file_0000000045ac61f793d04c4858aff2f3.png" type="image/png"> 
    
    <!-- Embedded CSS -->
    <style>
        :root{--primary-color:#0f3460;--secondary-color:#537895;--bg-color:#f0f2f5;--card-bg:#fff;--text-color:#333;--light-text-color:#888;--success-color:#28a745;--error-color:#dc3545;--shadow:0 4px 15px rgba(0,0,0,.08)}*{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif}body{background-color:var(--bg-color);color:var(--text-color);-webkit-tap-highlight-color:transparent}#app-loading{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--bg-color);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999}.spinner{border:4px solid rgba(0,0,0,.1);border-radius:50%;border-top:4px solid var(--primary-color);width:40px;height:40px;animation:spin 1s linear infinite;margin-bottom:15px}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.auth-container{display:none;justify-content:center;align-items:center;min-height:100vh;padding:20px}.auth-card{background:var(--card-bg);padding:30px 25px;border-radius:12px;box-shadow:var(--shadow);width:100%;max-width:380px;text-align:center}.auth-card h2{margin-bottom:25px;color:var(--primary-color)}.input-group{position:relative;margin-bottom:20px}
        .input-group .icon-emoji { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); font-size: 20px; color: var(--light-text-color); }
        .input-group input{width:100%;padding:12px 15px 12px 50px;border-radius:8px;border:1px solid #ddd;background:#fafafa;font-size:16px;transition:border-color .3s}.input-group input:focus{outline:none;border-color:var(--primary-color)}.btn-primary{width:100%;padding:14px;border:none;border-radius:8px;background:var(--primary-color);color:#fff;font-size:16px;font-weight:700;cursor:pointer;transition:background .3s ease}.btn-primary:hover{background:#1a5fad}.auth-toggle{margin-top:25px;color:var(--primary-color);cursor:pointer;font-weight:500}#app-container{display:none;flex-direction:column;height:100vh}.app-header{position:fixed;top:0;left:0;right:0;z-index:100;background:var(--card-bg);height:60px;padding:0 15px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 5px rgba(0,0,0,.05)}.welcome-text{font-weight:600;font-size:18px}.main-content{padding:75px 15px;flex-grow:1;overflow-y:auto}.page{display:none}.page.active{display:block;animation:fadeIn .5s}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.card{background:var(--card-bg);border-radius:12px;padding:20px;margin-bottom:20px;box-shadow:var(--shadow)}.card h3{margin-bottom:15px;border-bottom:1px solid #eee;padding-bottom:10px}.balance-card{text-align:center;background:linear-gradient(135deg,var(--primary-color),var(--secondary-color));color:#fff}.balance-card p{opacity:.8;margin-bottom:5px}.balance-card h1{font-size:36px}.task-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:15px;text-align:center}.task-item{background:var(--card-bg);border-radius:12px;padding:20px 10px;box-shadow:var(--shadow);cursor:pointer;transition:transform .2s}.task-item:active{transform:scale(.95)}
        .task-item .task-icon { font-size: 32px; color: var(--primary-color); display: block; margin-bottom: 10px; }
        .task-item span{font-weight:500}.form-group label{display:block;margin-bottom:8px;font-weight:500}.form-group input,.form-group select{width:100%;padding:12px;border:1px solid #ddd;border-radius:8px;font-size:16px}.info-item{display:flex;justify-content:space-between;align-items:center;padding:15px 0;border-bottom:1px solid #eee}.info-item:last-child{border-bottom:none}.info-item span:first-child{color:var(--light-text-color)}.info-item span:last-child{font-weight:500}
        .edit-btn { background: none; border: none; font-size: 20px; cursor: pointer; padding-left: 10px; }
        #ad-modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);z-index:1000;justify-content:center;align-items:center;flex-direction:column}#ad-modal .ad-content{background:#fff;padding:20px;border-radius:12px;text-align:center;min-height:290px;}#ad-modal .ad-timer{margin-top:15px;font-size:24px;font-weight:700;color:var(--primary-color)}.bottom-nav{position:fixed;bottom:0;left:0;right:0;z-index:100;height:60px;background:var(--card-bg);display:flex;justify-content:space-around;box-shadow:0 -2px 10px rgba(0,0,0,.06)}.nav-item{display:flex;flex-direction:column;align-items:center;justify-content:center;flex:1;color:var(--light-text-color);cursor:pointer;transition:color .3s}
        .nav-item .nav-icon { font-size: 24px; margin-bottom: 2px; }
        .nav-item span{font-size:12px;font-weight:500}.nav-item.active{color:var(--primary-color)}#toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);padding:10px 20px;border-radius:8px;color:#fff;z-index:1001;opacity:0;visibility:hidden;transition:all .4s}#toast.show{opacity:1;visibility:visible;top:75px}#toast.success{background:var(--success-color)}#toast.error{background:var(--error-color)}
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 2000; justify-content: center; align-items: center; padding: 20px; }
        .modal-content { background: var(--card-bg); padding: 25px; border-radius: 12px; width: 100%; max-width: 380px; text-align: center; }
        .modal-content h3 { margin-bottom: 20px; color: var(--primary-color); }
        .modal-content .btn-secondary { background-color: #ccc; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="app-loading">
        <div class="spinner"></div>
        <p>Loading RahatEarn...</p>
    </div>

    <div id="auth-container" class="auth-container">
        <div id="login-form" class="auth-card">
            <h2>Welcome Back!</h2>
            <form id="login">
                <div class="input-group"><span class="icon-emoji">üìß</span><input type="email" id="login-email" placeholder="Email Address" required></div>
                <div class="input-group"><span class="icon-emoji">üîí</span><input type="password" id="login-password" placeholder="Password" required></div>
                <button type="submit" class="btn-primary">Login</button>
            </form>
            <p class="auth-toggle" id="show-register-form">Don't have an account? <b>Register</b></p>
        </div>
        <div id="register-form" class="auth-card" style="display: none;">
            <h2>Create Account</h2>
            <form id="register">
                 <div class="input-group"><span class="icon-emoji">üë§</span><input type="text" id="register-name" placeholder="Full Name" required></div>
                <div class="input-group"><span class="icon-emoji">üìß</span><input type="email" id="register-email" placeholder="Email Address" required></div>
                <div class="input-group"><span class="icon-emoji">üîí</span><input type="password" id="register-password" placeholder="Password" required></div>
                <button type="submit" class="btn-primary">Register</button>
            </form>
            <p class="auth-toggle" id="show-login-form">Already have an account? <b>Login</b></p>
        </div>
    </div>
    
    <div id="app-container" style="display: none;">
        <header class="app-header">
            <div class="welcome-text">Welcome, <span id="welcome-name">User</span>!</div>
        </header>
        <main class="main-content">
            <div id="home-page" class="page active">
                <div class="card balance-card"><p>Current Balance</p><h1 id="balance-amount">‡ß≥0.00</h1></div>
                <div class="task-grid">
                    <div class="task-item" id="go-to-earn"><span class="task-icon">üí∞</span><span>Daily Tasks</span></div>
                    <div class="task-item" id="go-to-withdraw"><span class="task-icon">üì§</span><span>Withdraw</span></div>
                </div>
                <div class="card">
                    <h3>Referral System</h3>
                    <p>Share this link with friends to earn rewards!</p>
                    <input type="text" id="referral-link" readonly style="width: 100%; padding: 10px; margin-top: 10px; border: 1px solid #ddd; border-radius: 8px; text-align: center;">
                    <p style="text-align:center; margin-top:10px; font-size:14px; color: var(--light-text-color)">Total Referrals: <b id="referral-count">0</b></p>
                </div>
            </div>
            <div id="earn-page" class="page">
                <div class="card">
                    <h3>Daily Tasks</h3>
                    <p>Click the button below to watch a short ad and earn <b>‡ß≥0.03</b>. You can earn up to <b>‡ß≥3000</b> per day.</p>
                    <br>
                    <button id="watch-ad-btn" class="btn-primary">Watch Ad Now</button>
                </div>
            </div>
            <div id="withdraw-page" class="page">
                 <div class="card">
                    <h3>Request Withdrawal</h3>
                    <form id="withdraw-form">
                        <div class="form-group"><label for="withdraw-amount">Amount (‡ß≥)</label><input type="number" id="withdraw-amount" placeholder="Minimum 50" min="50" required></div>
                        <div class="form-group"><label for="withdraw-method">Method</label><select id="withdraw-method" required><option value="bKash">bKash</option><option value="Nagad">Nagad</option><option value="Mobile Recharge">Mobile Recharge</option></select></div>
                        <div class="form-group"><label for="withdraw-number">Account Number</label><input type="text" id="withdraw-number" placeholder="e.g., 01XXXXXXXXX" required></div>
                        <br>
                        <button type="submit" class="btn-primary">Submit Request</button>
                    </form>
                 </div>
            </div>
            <div id="profile-page" class="page">
                <div class="card">
                    <h3>My Profile</h3>
                    <div class="info-item">
                        <span>Full Name</span>
                        <div><span id="profile-name">Not Set</span><button id="edit-name-btn" class="edit-btn">‚úèÔ∏è</button></div>
                    </div>
                    <div class="info-item"><span>Email</span><span id="profile-email"></span></div>
                    <div class="info-item"><span>User ID</span><span id="profile-uid" style="font-size: 12px; word-break: break-all;"></span></div>
                </div>
                <button id="logout-btn" class="btn-primary" style="background-color: var(--error-color);">Logout</button>
            </div>
        </main>
        
        <div id="ad-modal">
            <div class="ad-content">
                <!-- =================================================================== -->
                <!-- Your Adsterra Ad Code is now here! -->
                <script type="text/javascript">
                    atOptions = {
                        'key' : 'e5504120cbdf9d4e895bf69417cd072f',
                        'format' : 'iframe',
                        'height' : 250,
                        'width' : 300,
                        'params' : {}
                    };
                </script>
                <script type="text/javascript" src="//www.highperformanceformat.com/e5504120cbdf9d4e895bf69417cd072f/invoke.js"></script>
                <!-- =================================================================== -->
                <div id="ad-timer" class="ad-timer">15</div>
            </div>
        </div>

        <nav class="bottom-nav">
            <div class="nav-item active" data-page="home-page"><span class="nav-icon">üè†</span><span>Home</span></div>
            <div class="nav-item" data-page="earn-page"><span class="nav-icon">‚ú®</span><span>Tasks</span></div>
            <div class="nav-item" data-page="withdraw-page"><span class="nav-icon">üí∏</span><span>Withdraw</span></div>
            <div class="nav-item" data-page="profile-page"><span class="nav-icon">üë§</span><span>Profile</span></div>
        </nav>
    </div>

    <div id="name-edit-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Update Your Name</h3>
            <form id="edit-name-form">
                <div class="form-group">
                    <input type="text" id="new-name-input" placeholder="Enter your full name" required>
                </div>
                <button type="submit" class="btn-primary">Save Changes</button>
            </form>
            <button id="cancel-edit-btn" class="btn-primary btn-secondary">Cancel</button>
        </div>
    </div>

    <div id="toast"></div>

    <script type="module" id="app-logic">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { getDatabase, ref, set, get, onValue, push, runTransaction, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyByWTYiRMf8tFgvU_ekxhMk6pB2uBXjPl8",
            authDomain: "rahatearn-rahatalwalid.firebaseapp.com",
            databaseURL: "https://rahatearn-rahatalwalid-default-rtdb.firebaseio.com",
            projectId: "rahatearn-rahatalwalid",
            storageBucket: "rahatearn-rahatalwalid.appspot.com",
            messagingSenderId: "1052795248949",
            appId: "1:1052795248949:web:ce3eb50d0ad5d0affdec7c"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        const loadingSpinner = document.getElementById('app-loading');
        const authContainer = document.getElementById('auth-container');
        const appContainer = document.getElementById('app-container');
        const pages = document.querySelectorAll('.page');
        const navItems = document.querySelectorAll('.nav-item');
        const toast = document.getElementById('toast');
        const nameEditModal = document.getElementById('name-edit-modal');
        const newNameInput = document.getElementById('new-name-input');
        
        const EARN_PER_AD = 0.03;
        const DAILY_EARN_LIMIT = 3000;
        const AD_TIMER_SECONDS = 15;
        let currentUser = null;
        let userDataListener = null;

        onAuthStateChanged(auth, (user) => {
            loadingSpinner.style.display = 'none';
            if (user) {
                currentUser = user;
                authContainer.style.display = 'none';
                appContainer.style.display = 'flex';
                setupUserListeners(user.uid);
                updateProfileUI(user);
                navigateTo('home-page');
            } else {
                currentUser = null;
                if (userDataListener) userDataListener();
                authContainer.style.display = 'flex';
                appContainer.style.display = 'none';
            }
        });

        function navigateTo(pageId) {
            pages.forEach(p => p.classList.remove('active'));
            navItems.forEach(n => n.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            const activeNavItem = document.querySelector(`.nav-item[data-page="${pageId}"]`);
            if (activeNavItem) activeNavItem.classList.add('active');
        }
        
        function showToast(message, type = 'success') {
            toast.textContent = message;
            toast.className = `show ${type}`;
            setTimeout(() => { toast.className = toast.className.replace('show', ''); }, 3000);
        }

        navItems.forEach(item => {
            item.addEventListener('click', () => navigateTo(item.dataset.page));
        });

        document.getElementById('show-register-form').addEventListener('click', () => {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('register-form').style.display = 'block';
        });

        document.getElementById('show-login-form').addEventListener('click', () => {
            document.getElementById('login-form').style.display = 'block';
            document.getElementById('register-form').style.display = 'none';
        });
        
        document.getElementById('go-to-earn').addEventListener('click', () => navigateTo('earn-page'));
        document.getElementById('go-to-withdraw').addEventListener('click', () => navigateTo('withdraw-page'));
        
        document.getElementById('referral-link').addEventListener('click', () => {
            const linkInput = document.getElementById('referral-link');
            if(!linkInput.value) return;
            linkInput.select();
            document.execCommand('copy');
            showToast('Referral link copied!');
        });

        document.getElementById('logout-btn').addEventListener('click', () => signOut(auth));

        document.getElementById('register').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                const refId = new URLSearchParams(window.location.search).get('ref');
                await set(ref(db, 'users/' + user.uid), { name, email, balance: 0, referrals: 0, referredBy: refId || null });
                if (refId) {
                    runTransaction(ref(db, `users/${refId}/referrals`), (count) => (count || 0) + 1);
                }
                showToast('Registration successful!', 'success');
            } catch (error) { showToast(error.message, 'error'); }
        });

        document.getElementById('login').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            try { await signInWithEmailAndPassword(auth, email, password); } 
            catch (error) { showToast(error.message, 'error'); }
        });

        document.getElementById('withdraw-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const userSnapshot = await get(ref(db, `users/${currentUser.uid}`));
            if (amount > userSnapshot.val().balance) { showToast('Insufficient balance.', 'error'); return; }

            try {
                await push(ref(db, 'withdrawals'), {
                    uid: currentUser.uid, email: currentUser.email, amount,
                    method: document.getElementById('withdraw-method').value,
                    number: document.getElementById('withdraw-number').value,
                    status: 'pending', timestamp: new Date().toISOString()
                });
                showToast('Withdrawal request submitted!', 'success');
                e.target.reset();
            } catch (error) { showToast(`Request failed: ${error.message}`, 'error'); }
        });
        
        document.getElementById('edit-name-btn').addEventListener('click', () => {
            const currentName = document.getElementById('profile-name').textContent;
            newNameInput.value = currentName === 'Not Set' ? '' : currentName;
            nameEditModal.style.display = 'flex';
        });

        document.getElementById('cancel-edit-btn').addEventListener('click', () => {
            nameEditModal.style.display = 'none';
        });

        document.getElementById('edit-name-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const newName = newNameInput.value.trim();
            if (newName && currentUser) {
                try {
                    const userRef = ref(db, 'users/' + currentUser.uid);
                    await update(userRef, { name: newName });
                    showToast('Name updated successfully!', 'success');
                    nameEditModal.style.display = 'none';
                } catch (error) {
                    showToast('Failed to update name.', 'error');
                }
            }
        });

        function setupUserListeners(uid) {
            const userRef = ref(db, 'users/' + uid);
            userDataListener = onValue(userRef, (snapshot) => {
                if (snapshot.exists()) {
                    updateUIWithUserData(snapshot.val());
                }
            });
        }
        
        function updateUIWithUserData(data) {
            const firstName = (data.name || 'User').split(' ')[0];
            document.getElementById('welcome-name').textContent = firstName;
            document.getElementById('profile-name').textContent = data.name || 'Not Set';
            document.getElementById('balance-amount').textContent = `‡ß≥${(data.balance || 0).toFixed(2)}`;
            document.getElementById('referral-count').textContent = data.referrals || 0;
        }

        function updateProfileUI(user) {
            document.getElementById('profile-email').textContent = user.email;
            document.getElementById('profile-uid').textContent = user.uid;
            const link = `${window.location.origin}${window.location.pathname}?ref=${user.uid}`;
            document.getElementById('referral-link').value = link;
        }
        
        document.getElementById('watch-ad-btn').addEventListener('click', async () => {
            const earningsRef = ref(db, `earnings/${currentUser.uid}`);
            const snapshot = await get(earningsRef);
            const earningsData = snapshot.val() || { dailyTotal: 0, lastEarnedDate: '' };
            const today = new Date().toISOString().split('T')[0];

            if (earningsData.lastEarnedDate === today && earningsData.dailyTotal >= DAILY_EARN_LIMIT) {
                showToast('Daily earning limit reached.', 'error'); return;
            }

            const adModal = document.getElementById('ad-modal');
            adModal.style.display = 'flex';
            let countdown = AD_TIMER_SECONDS;
            const timerEl = document.getElementById('ad-timer');
            timerEl.textContent = countdown;
            const timerInterval = setInterval(() => {
                countdown--;
                timerEl.textContent = countdown;
                if (countdown <= 0) {
                    clearInterval(timerInterval);
                    adModal.style.display = 'none';
                    creditUserReward();
                }
            }, 1000);
        });

        async function creditUserReward() {
            try {
                await runTransaction(ref(db, `users/${currentUser.uid}/balance`), (balance) => (balance || 0) + EARN_PER_AD);
                await runTransaction(ref(db, `earnings/${currentUser.uid}`), (data) => {
                    const today = new Date().toISOString().split('T')[0];
                    if (!data) data = { dailyTotal: 0, lastEarnedDate: '' };
                    if (data.lastEarnedDate !== today) { data.dailyTotal = 0; data.lastEarnedDate = today; }
                    data.dailyTotal += EARN_PER_AD;
                    return data;
                });
                showToast(`+ ‡ß≥${EARN_PER_AD.toFixed(2)} added!`, 'success');
            } catch (error) { showToast('Failed to add reward.', 'error'); }
        }
    </script>
</body>
</html> 
